# Лекція 6. Частотні методи стеганографії
## Тема 1: Методи стеганографії на основі дискретного косинусного перетворення в JPEG

### Вступ до частотних методів стеганографії

Фотографія - це просторове представлення: пікселі розташовані в певних місцях з певною яскравістю. Але це зображення можна представити зовсім інакше - як набір хвиль різної частоти, що накладаються одна на одну. Це подібно до того, як складний музичний акорд складається з окремих нот, або як біле світло містить усі кольори веселки.

Частотне представлення зображення дає унікальні можливості для приховування інформації. Людське око має особливість - воно по-різному сприймає різні частоти. Плавні переходи кольорів (низькі частоти) сприймаються дуже добре, а дрібні деталі та швидкі зміни (високі частоти) часто залишаються непоміченими. Саме цю особливість використовують частотні методи стеганографії.

### 1.1. Дискретне косинусне перетворення та його важливість

Дискретне косинусне перетворення (ДКП) - це математичний інструмент, який перетворює звичайне зображення у його частотне представлення.

#### Проблема зберігання зображень

Кольорове зображення розміром 1000×1000 пікселів без стиснення займає близько 3 мегабайтів. Для зберігання 1000 таких фотографій знадобиться 3 гігабайти. Але насправді більшість інформації в зображенні є надлишковою:

- Сусідні пікселі часто мають схожі кольори
- Великі області можуть бути однотонними
- Людське око не помічає дрібних деталей у певних місцях

JPEG використовує ДКП для видалення цієї надлишковості. Замість зберігання кожного пікселя, алгоритм зберігає частотні компоненти, відкидаючи ті, які людина все одно не побачить.

#### Принцип роботи ДКП - проста аналогія

Зображення можна порівняти з поверхнею води в басейні. Ця поверхня може бути:
- Спокійною (однотонна область) - це постійна складова
- З великими плавними хвилями (плавні переходи кольорів) - низькі частоти
- З дрібною брижею (текстура, деталі) - високі частоти

ДКП аналізує цю "поверхню" і записує: кількість спокійної води, кількість великих хвиль, кількість дрібних. При цьому для кожного типу хвиль записується не лише їх кількість, але й напрямок (горизонтальні, вертикальні, діагональні).

### 1.2. JPEG алгоритм - покрокове пояснення

Розглянемо, як JPEG обробляє зображення, і де виникають можливості для стеганографії:

#### Крок 1: Перетворення кольорів

Спочатку зображення перетворюється з RGB (червоний-зелений-синій) в YCbCr:
- **Y** - яскравість (чорно-біле зображення)
- **Cb** - відхилення в бік синього
- **Cr** - відхилення в бік червоного

Людське око набагато чутливіше до змін яскравості, ніж до змін кольору. Тому JPEG може сильніше стискати кольорові компоненти без помітної втрати якості. Для стеганографії це означає, що дані краще приховувати в компоненті яскравості Y.

#### Крок 2: Розбиття на блоки

Зображення ділиться на квадратики 8×8 пікселів. Причини вибору саме такого розміру:
- Достатньо малі, щоб в межах блоку колір змінювався не сильно
- Достатньо великі, щоб ефективно виявляти патерни
- 8 - степінь двійки, що спрощує обчислення

Кожен блок обробляється незалежно. Це створює проблему "блокових артефактів" при сильному стисненні - характерні квадратики на зображенні низької якості.

#### Крок 3: Застосування ДКП до кожного блоку

Тут відбувається основна "магія". Блок 8×8 пікселів перетворюється в блок 8×8 частотних коефіцієнтів:

- **Лівий верхній кут (позиція 0,0)** - середня яскравість всього блоку (постійна складова)
- **Коефіцієнти поруч** - плавні зміни яскравості
- **Правий нижній кут** - найдрібніші деталі

Важливе спостереження: у типовому блоці більшість енергії зосереджена в кількох коефіцієнтах у лівому верхньому куті, а решта коефіцієнтів близькі до нуля.

#### Крок 4: Квантування - ключ до стиснення і стеганографії

Квантування - це процес округлення чисел. Але округлення не до цілих, а з різним кроком для різних частот. Наприклад:
- Постійна складова округлюється точно
- Низькі частоти - з малим кроком
- Високі частоти - з великим кроком (або взагалі обнуляються)

Саме після квантування з'являється багато нульових коефіцієнтів, що дає високе стиснення. І саме тут найзручніше вбудовувати приховані дані - модифікуючи квантовані коефіцієнти.

#### Крок 5: Зигзагоподібне сканування та кодування

Коефіцієнти зчитуються не по рядках, а зигзагом - від низьких частот до високих. Це групує нулі в кінці, що покращує стиснення. Потім застосовується кодування Хаффмана - часті значення кодуються коротшими кодами.

### 1.3. Класичні методи стеганографії в DCT області

Тепер, коли ми розуміємо структуру JPEG, розглянемо, як різні методи використовують її для приховування даних.

#### 1.3.1. JSteg - простий початок

JSteg був одним з перших методів. Його принцип надзвичайно простий:

1. Беремо квантований DCT коефіцієнт
2. Якщо він не 0 і не ±1, замінюємо його молодший біт на біт повідомлення
3. Коефіцієнти 0 та ±1 не чіпаємо

Причини виключення 0 та ±1:
- **Нулі** - їх дуже багато, зміна створить помітні артефакти
- **±1** - зміна може перетворити їх в 0 або ±2, що сильно впливає на статистику

**Проблема JSteg:** Метод змінює природну статистику коефіцієнтів. У звичайному зображенні кількість парних і непарних коефіцієнтів різна. JSteg їх вирівнює, що легко виявляється статистичними тестами.

#### 1.3.2. OutGuess - спроба замаскуватися

OutGuess намагається вирішити проблему JSteg через двоетапний процес:

**Етап 1:** Вбудовування даних
- Використовується лише половина доступних коефіцієнтів
- Вибір псевдовипадковий, залежить від секретного ключа
- Дані вбудовуються як в JSteg

**Етап 2:** Статистичне коригування
- Аналізується, як змінилася статистика після вбудовування
- Друга половина коефіцієнтів модифікується так, щоб відновити оригінальну статистику

Це як приховати сліди на піску - спочатку залишаємо відбитки, потім акуратно вирівнюємо пісок навколо, щоб не було помітно змін.

**Проблема OutGuess:** Хоча глобальна статистика відновлюється, локальні залежності між коефіцієнтами порушуються. Сучасні методи стегоаналізу це виявляють.

#### 1.3.3. F5 - революція через матричне кодування

F5 приніс дві ключові інновації:

**Інновація 1: Зменшення замість заміни**

Замість заміни молодшого біта, F5 зменшує абсолютне значення коефіцієнта:
- Було 5 → стає 4
- Було -5 → стає -4
- Було 2 → стає 1

Це створює більш природний розподіл змін. Але виникає "проблема усадки" - якщо коефіцієнт стає 0, він виключається з процесу, і доводиться вбудовувати біт заново в інший коефіцієнт.

**Інновація 2: Матричне кодування**

Замість зміни одного коефіцієнта для одного біта, F5 групує коефіцієнти. Наприклад, група з 7 коефіцієнтів може нести 3 біти інформації, змінюючи максимум 1 коефіцієнт.

Аналогія: замість того, щоб писати по одній букві на кожному аркуші паперу, ми пишемо код, який можна прочитати, подивившись на групу аркушів разом. Це значно зменшує кількість змін.

### 1.4. Адаптивні методи - розумний вибір місць для приховування

Сучасні методи не вбудовують дані рівномірно. Вони аналізують зображення і вибирають місця, де зміни будуть найменш помітними.

#### Принцип адаптивності

Приклад з повсякденного життя: при необхідності сховати предмет у кімнаті, найкращі місця:
- Не порожня полиця (помітно відразу)
- Не центр столу (занадто очевидно)
- Краще в захаращеному кутку або серед інших предметів

Так само працює адаптивна стеганографія:
- Уникає гладких областей (небо, стіни)
- Віддає перевагу текстурованим областям (листя, трава)
- Враховує локальну складність

#### UNIWARD для JPEG

Цей метод обчислює "вартість" зміни кожного коефіцієнта. Вартість залежить від:

1. **Текстурної складності** - в складних областях зміни менш помітні
2. **Частотної характеристики** - високі частоти краще для приховування
3. **Впливу на сусідні блоки** - уникаємо створення блокових артефактів

Алгоритм вибирає коефіцієнти з мінімальною вартістю, як покупець в магазині вибирає найдешевші товари при обмеженому бюджеті.

### 1.5. Практичні аспекти реалізації

#### Вибір параметрів

**Якість JPEG (Q-фактор):**
- Q=100: максимальна якість, мінімальне стиснення, багато ненульових коефіцієнтів
- Q=90-95: типова якість для фотографій
- Q=75: стандартне значення, хороший баланс
- Q=50 і нижче: помітні артефакти, мало місця для стеганографії

Парадокс: при високій якості більше місця для приховування, але зміни більш помітні. При низькій якості зміни менш помітні, але місця мало.

**Вибір кольорового каналу:**
- **Y (яскравість)** - найбільше коефіцієнтів, основне місце для даних
- **Cb, Cr (колір)** - часто сильно стиснуті, менше місця, але зміни менш помітні

#### Синхронізація

Відправник і отримувач повинні однаково інтерпретувати структуру JPEG:
- Порядок обходу блоків
- Порядок коефіцієнтів в блоці
- Ініціалізація генератора псевдовипадкових чисел
- Довжина повідомлення або маркер кінця

Це як домовленість про те, в якому порядку читати книгу з переставленими сторінками.

### 1.6. Стегоаналіз - як виявляють приховані дані

#### Статистичні методи

Кожен метод вбудовування залишає характерні "відбитки пальців" в статистиці:

**Хі-квадрат тест для JSteg:**
У природному зображенні пари коефіцієнтів (2,3), (4,5), (6,7) мають різну частоту появи. JSteg їх вирівнює через заміну молодших бітів. Статистичний тест це легко виявляє.

**Метод калібрування:**
1. Беремо підозріле зображення
2. Декодуємо його в просторову область
3. Обрізаємо на кілька пікселів
4. Знову стискаємо в JPEG
5. Порівнюємо статистики

Якщо є стеганографія, статистики будуть сильно відрізнятися, бо обрізання зсуває сітку блоків 8×8.

#### Машинне навчання

Сучасні методи витягують сотні або тисячі статистичних ознак:
- Гістограми коефіцієнтів
- Кореляції між сусідніми блоками
- Статистики вищих порядків

Ці ознаки подаються на вхід класифікатора (наприклад, нейронної мережі), який навчається розрізняти чисті та модифіковані зображення. Це як навчити собаку знаходити наркотики - після тренування на тисячах прикладів, система починає "відчувати" присутність прихованих даних.

### 1.7. Переваги та обмеження DCT-методів

#### Переваги

1. **Сумісність з JPEG** - найпоширеніший формат зображень
2. **Відпрацьовані методи** - десятиліття досліджень та вдосконалень
3. **Відносна стійкість** - дані переживають повторне стиснення (якщо параметри близькі)
4. **Достатня ємність** - можна приховати від 5% до 15% від розміру файлу

#### Обмеження

1. **Блокові артефакти** - при великому навантаженні з'являються характерні квадратики
2. **Чутливість до обробки** - поворот, масштабування, обрізання знищують дані
3. **Розвинутий стегоаналіз** - багато методів виявлення
4. **Залежність від формату** - працює тільки з JPEG

### Висновки

Методи стеганографії на основі DCT пройшли довгий шлях від простої заміни бітів до складних адаптивних систем. Основний тренд - перехід від максимізації ємності до мінімізації виявності.

Ключове розуміння: успішна стеганографія - це не про те, щоб сховати якомога більше даних, а про те, щоб сховати їх так, щоб ніхто не запідозрив їх наявність. Це мистецтво балансу між ємністю, стійкістю та непомітністю.

DCT-методи залишаються актуальними завдяки повсюдності JPEG, але майбутнє, ймовірно, за методами, що використовують нові формати (JPEG2000, WebP) та штучний інтелект для ще кращого маскування.

### Контрольні питання для самоперевірки

1. Поясніть особливості сприйняття людським оком різних частот і застосування цього в стеганографії.
2. Поясніть причини виключення коефіцієнтів зі значеннями 0 та ±1 в алгоритмі JSteg.
3. Опишіть принципову різницю між підходами JSteg та F5 до модифікації коефіцієнтів.
4. Обґрунтуйте складність виявлення адаптивних методів порівняно з методами з рівномірним розподілом.
5. Поясніть принцип роботи методу калібрування для виявлення стеганографії в JPEG.
6. Проаналізуйте парадокс помітності стеганографії при високій якості JPEG (Q=95-100).
7. Опишіть роль секретного ключа в стеганографічних системах.